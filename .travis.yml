language: node_js
cache:
  directories: node_modules
node_js:
- '6'
notifications:
  slack:
    secure: zHxNg8TGACY5sCLJmj0P81+EDkYmmSQ5ItTzLrpzzCvZ2CFTibdbEbn03RO+3tEzdrhPTkRf3SLRkXDvVkCh4ZN2+zMSTnLaSuTZI1Ydtrwg+xTO+34U8sSYFp3JmNFwb8WRZ7oWKUevHcuT721qZlHR+PL3Xz5dNBVw8IMFKeMMR610LlGfoGkKjQZKHawUNJ4cjiZwcyU/VlXiOVbpoyu3/wPb0ul+rXwTP2bERb/3ZJF1BKmUGAwnFD7KnJ7U2OdQQFcxW80/m3wjWhtnWrGBAkcfy3Po3+NzitqGUORxawhCXBu4ToTK0FBJJ123A1P5AxBqk4FKHQF6kG0AIZOvXax94Ktci+Uy2I1UinftNM5pOemMKhQ8AmFG3ohBLlrth4bYXQf/qBVuargB7+4W4VjTRHgVa1BLHZppDa2m8DjXTzN7g6NiRZDEo5LUJ+ygdH/0evgqQT+RZoxhOreUcunWSg5q3UUMWmvZ5rAwiOCadIGSAyeLR/8J9HM2+pUVSvWb3vTDMdh/I02bN6oOxtcUhH7pO/15+klqWL5ZXhlYgxD6ObsyBeB2l//T7scerzkLmSMS3BcCn1ARaYU7nj4WfulgbcEvlcVBNQ7+It9WkDHJ+GUs8jlcp7InB1wGQbc/2GKmXm9EOjU9hCUpDHG4e4TFYrxGrO9g1LA=
sudo: required
services:
- docker
before_install:
- openssl aes-256-cbc -K $encrypted_4056667d1569_key -iv $encrypted_4056667d1569_iv
  -in client-secret.json.enc -out client-secret.json -d
- if [ ! -d ${HOME}/google-cloud-sdk ]; then
     curl https://sdk.cloud.google.com | bash;
  fi
- gcloud auth activate-service-account --key-file client-secret.json
- sudo gcloud components update
- sudo gcloud components update kubectl
- gcloud config set container/cluster floq
- gcloud config set compute/zone europe-west1-b
- gcloud config set project marine-cycle-97212
- gcloud container clusters get-credentials floq
install:
- export ENV="test"
- docker build -t floq .
- docker run -d -p 127.0.0.1:3000:3000 floq
- docker ps -a
after_success:
- if [ $TRAVIS_BRANCH == 'develop' ]; then
    docker login -e="$DOCKER_EMAIL" -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";
    docker tag floq blankoslo/floq:$ENV-$TRAVIS_COMMIT;
    docker push blankoslo/floq:$ENV-$TRAVIS_COMMIT;
    export GOOGLE_APPLICATION_CREDENTIALS="${PWD}/client-secret.json";
    kubectl set image deployment/floq-blank-$ENV floq-blank-$ENV=blankoslo/floq:$ENV-$TRAVIS_COMMIT
  fi
env:
  matrix:
  - CLOUDSDK_CORE_DISABLE_PROMPTS=1
  global:
  - secure: ycsFhUHYS68Tl5N2EqYE2iN0HcVCHW+0zAcLqW1/Fi2YwxrVEz6OuqLmDt03iAvn3EMpZli3YZTN0a4bfpuCTHmLaQN0aJVENXiqnVHgOPfMMRrUCi4DxSd0OofR5qBWT1FwjIW70yXXqOOBL5J35Izh231DNHLGssteBgWDg7ETYvHr/bcFrV6qC+wg2lXFCp7A6EVhVUNHalBwGGkV958CDf4llaViyWE3I3tF2RCVrI8LZ5r6vCOEEgIcUYqb9z4i2xFZfURFrX0wMWcZ7rAu96LFCwdQcTtZBOdmGRm96Du+NQ1SYcB97RzSVnEaShG9wYV/979pb0zIXFBVJqBgA1r0NEk6spmIDUsk69NGloOU45eiVgVgUHdHhH+3wfkouVJukiIvE6ZTHVLR+B283fABedokbGdlcq90HDQBjg95B8WLtNwcFInfnOQjNOuCuB4Lcd+kXq8fpy/MqFQ6SQPt+fX3Bh7furJb+iVfxh9jyLYB1NLl2g6ZjD+jiMobscGGn9aUaYo/0cYBmayuxqIMpChSItsQfscHH5i6wlmTJwpK5rrNbBbE0G6b+peXx7kNP/XWEiCt+WCZF63+p9OnS9jv/UK5pwkC0MPmhKSCurhi3qLCEyU/tuNeRwMMWwEHIDgkvkaFZ6lOF2nT4z67GairkItGQrHiK/8=
  - secure: LKJKUK8XXX0pcSOojoa4BgUML6MF2lZY2wgUSFQe6csSQZReiwCGaFIDWN+SneGF9pGJVJRKzjfKxj7s9gfhtT+8rx1DGsJATW1YRRkJC9ETbwA/6m17Y0Jmclav/J1EFn27bxuq/E6pGm8CvLet/jrOJr1V7Ble6LnpcRhOhbfkrKzr0IzoL+PH3obPINgh3tIBEUf300nzbe5J9/dpclINDgWr4UjHWkHap8j87wn9Vb2HgXpUjepnGfdsSrjOsv76yxF5oPzvx1bmKaelclXE8Cvnp99Fyf3VDi4chlUK/flZ9AmiobBVbDBIZwKbshsWn5KsEKCu4CmwapB/BFtCA3ncs5WjDXpliqSA2Ex8EKi3wv1fkuSkY8aunxAoc7ZI+45hww7H0wHr1YIMetp7hRF00DZZUOWLmZMBTXGfuILl3Dwx+7CZC1Ej8GOHwVIvNLFL22sV0CZYz+UsHLntSgUbMYd8/7isWJEFA7uT1LKQMUoVbzKDossveck3PS77RrJdaXKyemdzo3IEs4lGbdhHb/LMNH8kesIgvAAfMHkGUtoZHootS3YSA8PsTbE7Qf3XPqthvlC9qhMmyBDXBU/EzeGXumZ9cHozuDE5uLuBwtyiHbTlKSBBScvH1abbO39y12mXo5Bd5s6yTfYlbomYMz0fiZTJaFCnlnk=
  - secure: V0M18PWabvW+H0dO8lze+0Rp9yuWvZ7kYhE06/U/O4QliXhFzNS68lurgHJXp4MaJ2tVZFdO6XYRszHiE6e5gogMtarelf7Yljkh39p80bSiAO1ykpwcga2iJoxofkW8YNwKnjs2nEe8b5p1nLqjG57pG+jIJZMbFfZwh/KtNnw1U/fxDs36knskg0OIBhK4GuZuiYLAcUEXpsEA0Cpe5R35+v2IaMBa92IXUtgHfv53zMIV6zIM0xtRdWrKyDfqERCH26svkXgJb5H1851jfRLP0w0sM4Ou9GvP07Br6Zoz/n3N9UrgHqvqn59u0BDn1MlRyHYFqF7mIGj8YT9uxKJR2pckrorU6bIpXto3W7LVfb6pJfq6b4fPppoiizbKVPrTgbl7jxWbePhvoa57KPuq1Biudh4+s+HahV7dKBkPCz2giLrN2Ibv0xSDpeAIrs1DQ64Dz1WeX98GQ+qMg42fiH94+26A+CUE/AxUUwBRsVkaav+h1P3Py97KiYg3VWHKMmTXzzJFnIK2w7VCa1q/uZlMY+97Ye0K3ny5MmsODcsziBkrnpnJ7OPecvXWmJpEBiQdtdXRlaP18dlk2+qjIhE8hMlCEs0D2qDjpv02m9/AAs3v3G51QLUPEmJmamE2w1LEX0qTgC1Qtxtx17AKDzBUftvWNYdmiaOo+bk=

